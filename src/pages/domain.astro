---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const title = 'Domain æŸ¥è©¢å·¥å…·';
const description = 'ä½¿ç”¨ Cloudflare DNS-over-HTTPS æŸ¥è©¢ A/AAAA/NS/MX è¨˜éŒ„èˆ‡æ˜¯å¦å¯ç”¨';
---

<!doctype html>
<html lang="zh-Hant">
  <head>
    <BaseHead title={title} description={description} />

    <style>
      :root {
        --bg: #ffffff;
        --panel: #ffffff;
        --border: rgba(0,0,0,0.1);
        --muted: #6b7280;
        --accent: #1e293b; /* é»‘ç° Cloudflare */
        --accent-hover: #0f172a;
        --card-radius: 12px;
      }

      body {
        background: var(--bg);
        margin: 0;
        font-family: Inter, system-ui, sans-serif;
      }

      main.container {
        max-width: 1100px;
        margin: 40px auto;
        padding: 0 20px;
      }

      .card {
        background: var(--panel);
        padding: 26px;
        border-radius: var(--card-radius);
        border: 1px solid var(--border);
      }

      h1 {
        margin: 0 0 14px;
        font-size: 1.6rem;
        font-weight: 700;
      }

      .desc {
        margin-bottom: 18px;
        color: var(--muted);
      }

      /* Cloudflare é¢¨æ ¼è¼¸å…¥å€ */
      .input-box {
        display: flex;
        gap: 10px;
        margin-bottom: 18px;
        width: 100%;
      }

      .input-box input {
        flex: 1;
        padding: 14px 16px;
        border: 1px solid var(--border);
        border-radius: 10px;
        font-size: 1rem;
        width: 100%;
        box-sizing: border-box;
      }

      .input-box input:focus {
        border-color: #2563eb;
        outline: none;
        box-shadow: 0 0 0 2px rgba(37,99,235,0.15);
      }

      button {
        background: var(--accent);
        border: none;
        color: #fff;
        padding: 0 20px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        white-space: nowrap;
      }

      button:hover {
        background: var(--accent-hover);
      }

      /* æ‰‹æ©Ÿ RWD */
      @media (max-width: 600px) {
        .input-box {
          flex-direction: column;
        }
        button {
          width: 100%;
        }
      }

      .result-box {
        margin-top: 20px;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: #f8fafc;
      }

      .row {
        padding: 10px 0;
        display: flex;
        justify-content: space-between;
        border-bottom: 1px solid rgba(0,0,0,0.05);
      }

      .row:last-child {
        border-bottom: none;
      }

      .label {
        color: var(--muted);
      }
    </style>
  </head>

  <body>
    <Header />
    <main class="container">
      <div class="card">
        <h1>Domain æŸ¥è©¢å·¥å…·</h1>
        <div class="desc">ä½¿ç”¨ Cloudflare DNS-over-HTTPS æŸ¥è©¢ A / AAAA / NS / MX è¨˜éŒ„ï¼Œä¸¦åˆ¤æ–·æ˜¯å¦å¯è¨»å†Šã€‚</div>

        <div class="input-box">
          <input id="domainInput" placeholder="è¼¸å…¥ Domainï¼Œä¾‹å¦‚ï¼šexample.com" />
          <button id="searchBtn">æŸ¥è©¢</button>
        </div>

        <div id="resultArea"></div>
      </div>
    </main>
    <Footer />

<script>
  const input = document.getElementById("domainInput");
  const btn = document.getElementById("searchBtn");
  const area = document.getElementById("resultArea");

  btn.addEventListener("click", search);
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") search();
  });

  // æŸ¥è©¢ Cloudflare DoH
  async function queryDNS(domain, type) {
    const url = `https://cloudflare-dns.com/dns-query?name=${domain}&type=${type}`;
    const res = await fetch(url, {
      headers: { "accept": "application/dns-json" }
    });
    return res.json();
  }

  function parseAnswer(ans) {
    if (!ans || !ans.Answer) return null;
    return ans.Answer.map(r => `${r.data} <span style="color:#64748b;">(TTL ${r.TTL})</span>`).join("<br>");
  }

  async function search() {
    const domain = input.value.trim();
    if (!domain) return;

    area.innerHTML = `<div class="result-box">æŸ¥è©¢ä¸­...</div>`;

    try {
      const [A, AAAA, CNAME, TXT, MX, NS, SOA, DNSKEY] = await Promise.all([
        queryDNS(domain, "A"),
        queryDNS(domain, "AAAA"),
        queryDNS(domain, "CNAME"),
        queryDNS(domain, "TXT"),
        queryDNS(domain, "MX"),
        queryDNS(domain, "NS"),
        queryDNS(domain, "SOA"),
        queryDNS(domain, "DNSKEY")
      ]);

      const result = {
        A: parseAnswer(A),
        AAAA: parseAnswer(AAAA),
        CNAME: parseAnswer(CNAME),
        TXT: TXT.Answer ? TXT.Answer.map(r => r.data.replace(/"/g, "")).join("<br>") : null,
        MX: MX.Answer ? MX.Answer.map(r => r.data).join("<br>") : null,
        NS: parseAnswer(NS),
        SOA: SOA.Answer ? SOA.Answer.map(r => r.data).join("<br>") : null,
        DNSSEC: DNSKEY.Answer ? "ğŸŸ¢ å•Ÿç”¨" : "ğŸ”´ æœªå•Ÿç”¨",
        available: A.Status === 3 && AAAA.Status === 3 && MX.Status === 3 // NXDOMAIN
      };

      area.innerHTML = `
        <div class="result-box">

          <div class="row">
            <span class="label">Domain</span><span>${domain}</span>
          </div>

          <div class="row">
            <span class="label">å¯ç”¨ï¼Ÿ</span>
            <span>${result.available ? 'âœ… å¯è¨»å†Š' : 'âŒ å·²è¢«ä½¿ç”¨'}</span>
          </div>

          <div class="row"><span class="label">A</span><span>${result.A || 'â€”'}</span></div>
          <div class="row"><span class="label">AAAA</span><span>${result.AAAA || 'â€”'}</span></div>
          <div class="row"><span class="label">CNAME</span><span>${result.CNAME || 'â€”'}</span></div>
          <div class="row"><span class="label">MX</span><span>${result.MX || 'â€”'}</span></div>
          <div class="row"><span class="label">NS</span><span>${result.NS || 'â€”'}</span></div>

          <div class="row"><span class="label">TXT</span><span>${result.TXT || 'â€”'}</span></div>

          <div class="row"><span class="label">SOA</span>
            <span style="text-align:right">${result.SOA || 'â€”'}</span>
          </div>

          <div class="row"><span class="label">DNSSEC</span><span>${result.DNSSEC}</span></div>

        </div>
      `;
    } catch (err) {
      area.innerHTML = `<div class="result-box">âŒ æŸ¥è©¢å¤±æ•—ï¼ˆè«‹ç¨å¾Œå†è©¦ï¼‰</div>`;
    }
  }
</script>


  </body>
</html>
