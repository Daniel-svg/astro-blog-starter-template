---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

const title = 'æˆ‘çš„ IP æŸ¥è©¢å·¥å…·';
---

<!doctype html>
<html lang="zh-Hant">
<head>
Â   <!-- ğŸ’¡ BaseHead è² è²¬å¼•å…¥å…¨åŸŸ CSS -->
    <BaseHead title={title} description={description} />

Â  Â  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
Â  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

Â  <style>
Â  Â  .main-container {
Â  Â  Â  max-width: 700px;
Â  Â  Â  margin: 40px auto;
Â  Â  Â  padding: 1.5em;
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  .card {
Â  Â  Â  background: white;
Â  Â  Â  padding: 40px;
Â  Â  Â  border-radius: 18px;
Â  Â  Â  box-shadow: 0 10px 35px rgba(0,0,0,0.08);
Â  Â  }

Â  Â  .ip-title {
Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  color: #3a475d;
Â  Â  Â  margin-bottom: 12px;
Â  Â  Â  font-weight: 600;
Â  Â  }

Â  Â  .ip-address {
Â  Â  Â  font-size: 2.5rem;
Â  Â  Â  font-weight: 800;
Â  Â  Â  color: #2563eb;
Â  Â  Â  background: #eef4ff;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  margin: 0 auto 25px;
Â  Â  Â  display: inline-block;
Â  Â  Â  word-break: break-all; /* ç¢ºä¿é•· IP åœ°å€ä¸æœƒè¶…å‡º */
Â  Â  }

Â  Â  /* ==================================== */
Â  Â  /* âœ¨ è³‡è¨Šå€å¡Š (Details) å„ªåŒ–èˆ‡ä¿®æ­£ âœ¨ */
Â  Â  /* ------------------------------------ */

Â  Â  /* ç¶²æ ¼å®¹å™¨: åœ¨å¤§è¢å¹•é¡¯ç¤ºå…©æ¬„ï¼Œå°è¢å¹•è‡ªå‹•èª¿æ•´ */
Â  Â  .details-grid {
Â  Â  Â  display: grid;
	  color: #2563eb;
Â  Â  Â  background: #eef4ff;
Â  Â  Â  /* è‡ªå‹•èª¿æ•´æ¬„ä½å¯¬åº¦ï¼Œæœ€å° 280pxï¼Œæœ€å¤§ 1fr */
Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
Â  Â  Â  gap: 15px;
Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  text-align: left;
Â  Â  }

Â  Â  /* å–®ä¸€è³‡è¨Šæ¡†çš„æ¨£å¼ (å–ä»£äº† info-box) */
Â  Â  .detail-box {
Â  Â  Â  background-color: #ffffff;
Â  Â  Â  padding: 15px;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
Â  Â  Â  border: 1px solid #e3ebf5;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column; /* å‚ç›´å †ç–Šæ¨™ç±¤å’Œå€¼ */
Â  Â  Â  transition: all 0.2s;
Â  Â  }
Â  Â  
Â  Â  .detail-box:hover {
Â  Â  Â  transform: translateY(-3px);
Â  Â  Â  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
Â  Â  }

Â  Â  .detail-label {
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: #55637a;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 8px;
Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  font-size: 0.9rem;
Â  Â  }

Â  Â  .detail-value {
Â  Â  Â  font-weight: 700;
Â  Â  Â  color: #1c2a3a;
Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  word-break: break-all; /* ç¢ºä¿é•·æ–‡å­—æ›è¡Œ */
Â  Â  }

Â  Â  .flag {
Â  Â  Â  font-size: 1.5rem;
Â  Â  }

Â  Â  /* ==================================== */

Â  Â  #map {
Â  Â  Â  width: 100%; /* ç¢ºä¿åœ°åœ–ä¸è¶…å‡ºçˆ¶å®¹å™¨å¯¬åº¦ */
Â  Â  Â  height: 350px;
Â  Â  Â  margin-top: 30px;
Â  Â  Â  border-radius: 14px;
Â  Â  Â  overflow: hidden;
Â  Â  }

Â  Â  .reload-btn {
Â  Â  Â  margin-top: 25px;
Â  Â  Â  padding: 12px 32px;
Â  Â  Â  background: #2563eb;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  font-size: 1rem;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: background 0.3s;
Â  Â  }

Â  Â  .reload-btn:hover {
Â  Â  Â  background: #1e40af;
Â  Â  }

Â  Â  .data-source {
Â  Â  Â  margin-top: 30px;
Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  color: #55637a;
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  .data-source a {
Â  Â  Â  color: #2563eb;
Â  Â  Â  text-decoration: none;
Â  Â  }

Â  Â  .data-source a:hover {
Â  Â  Â  text-decoration: underline;
Â  Â  }
Â  </style>
</head>

<body>
Â  <Header />

Â  <main class="main-container">
Â  Â  <div class="card">
Â  Â  Â  <div class="ip-title">ä½ çš„å…¬é–‹ IP åœ°å€</div>
Â  Â  Â  <div class="ip-address" id="ip">è¼‰å…¥ä¸­...</div>

Â  Â  Â  Â  Â  Â  <div class="details-grid" id="details"></div>

Â  Â  Â  <div id="map"></div>
Â  Â  </div>

Â  Â  <button class="reload-btn" id="reload">é‡æ–°æ•´ç†</button>

Â  Â  <div class="data-source">
Â  Â  Â  <p>æ•¸æ“šä¾†æºï¼š</p>
Â  Â  Â  <p>
Â  Â  Â  Â  å…¬é–‹ IP æŸ¥è©¢ç”±Â 
Â  Â  Â  Â  <a href="https://www.ipify.org/" target="_blank" rel="noopener noreferrer">ipify</a>
Â  Â  Â  Â  æä¾›ï¼›åœ°ç†ä½ç½®è³‡è¨Šç”±Â 
Â  Â  Â  Â  <a href="https://ipinfo.io/" target="_blank" rel="noopener noreferrer">IPinfo</a>Â 
Â  Â  Â  Â  æä¾›ã€‚
Â  Â  Â  </p>
Â  Â  </div>
Â  </main>

Â  <Footer />

Â  <script>
Â  Â  function countryToFlag(countryCode) {
Â  Â  Â  if (!countryCode) return "â“";
Â  Â  Â  return countryCode.toUpperCase().replace(/./g, char =>Â 
Â  Â  Â  Â  String.fromCodePoint(char.charCodeAt(0) + 127397)
Â  Â  Â  );
Â  Â  }

Â  Â  // å®£å‘Šä¸€å€‹è®Šæ•¸ä¾†ä¿å­˜åœ°åœ–å¯¦ä¾‹ï¼Œä»¥ä¾¿åœ¨ä¸‹æ¬¡è¼‰å…¥æ™‚ç§»é™¤
Â  Â  let mapInstance = null;

Â  Â  async function fetchIP() {
Â  Â  Â  const ipEl = document.getElementById('ip');
Â  Â  Â  const detailsEl = document.getElementById('details');
Â  Â  Â  
Â  Â  Â  ipEl.textContent = 'è¼‰å…¥ä¸­...';
Â  Â  Â  detailsEl.innerHTML = '';
Â  Â  Â  
Â  Â  Â  // éŠ·æ¯€èˆŠåœ°åœ–å¯¦ä¾‹
Â  Â  Â  if (mapInstance) {
Â  Â  Â  Â  mapInstance.remove();
Â  Â  Â  Â  mapInstance = null;
Â  Â  Â  }

Â  Â  Â  try {
Â  Â  Â  Â  const ipRes = await fetch('https://api.ipify.org?format=json');
Â  Â  Â  Â  const { ip } = await ipRes.json();
Â  Â  Â  Â  ipEl.textContent = ip;

Â  Â  Â  Â  // è«‹æ³¨æ„ï¼šæ‚¨æ­£åœ¨ç¨‹å¼ç¢¼ä¸­å…¬é–‹ä½¿ç”¨ IPinfo tokenï¼Œé€™åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­å­˜åœ¨å®‰å…¨é¢¨éšªã€‚
Â  Â  Â  Â  // å»ºè­°å°‡æ­¤ API å‘¼å«ç§»è‡³å¾Œç«¯é€²è¡Œè™•ç†ã€‚
Â  Â  Â  Â  const infoRes = await fetch(`https://ipinfo.io/${ip}/json?token=1b172809b09566`);
Â  Â  Â  Â  const info = await infoRes.json();

Â  Â  Â  Â  const infoList = [
Â  Â  Â  Â  Â  { label: 'åœ‹å®¶/åœ°å€', value: info.country || 'N/A', flag: countryToFlag(info.country) },
Â  Â  Â  Â  Â  { label: 'åŸå¸‚', value: info.city || 'N/A' },
Â  Â  Â  Â  Â  { label: 'å€åŸŸ/å·', value: info.region || 'N/A' },
Â  Â  Â  Â  Â  { label: 'éƒµéå€è™Ÿ', value: info.postal || 'N/A' },
Â  Â  Â  Â  Â  { label: 'ç¶²éš›ç¶²è·¯æœå‹™ä¾›æ‡‰å•† (ISP)', value: info.org || 'N/A' },
Â  Â  Â  Â  Â  { label: 'GPS åº§æ¨™', value: info.loc ? info.loc.replace(',', ', ') : '0, 0' },
Â  Â  Â  Â  Â  { label: 'æ™‚å€', value: info.timezone || 'N/A' },
Â  Â  Â  Â  ];

Â  Â  Â  Â  infoList.forEach(item => {
Â  Â  Â  Â  Â  const box = document.createElement('div');
Â  Â  Â  Â  Â  box.className = 'detail-box'; // ä½¿ç”¨ä¿®æ­£å¾Œçš„ class åç¨±

Â  Â  Â  Â  Â  const label = document.createElement('div');
Â  Â  Â  Â  Â  label.className = 'detail-label'; // ä½¿ç”¨ä¿®æ­£å¾Œçš„ class åç¨±
Â  Â  Â  Â  Â  label.textContent = item.label;
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  if (item.flag) {
Â  Â  Â  Â  Â  Â  const flagSpan = document.createElement('span');
Â  Â  Â  Â  Â  Â  flagSpan.className = 'flag';
Â  Â  Â  Â  Â  Â  flagSpan.textContent = item.flag;
Â  Â  Â  Â  Â  Â  label.appendChild(flagSpan);
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  const value = document.createElement('div');
Â  Â  Â  Â  Â  value.className = 'detail-value'; // ä½¿ç”¨ä¿®æ­£å¾Œçš„ class åç¨±
Â  Â  Â  Â  Â  value.textContent = item.value;

Â  Â  Â  Â  Â  box.appendChild(label);
Â  Â  Â  Â  Â  box.appendChild(value);
Â  Â  Â  Â  Â  detailsEl.appendChild(box);
Â  Â  Â  Â  });

Â  Â  Â  Â  let [lat, lon] = info.loc ? info.loc.split(",").map(c => parseFloat(c)) : [0, 0];

Â  Â  Â  Â  // åˆå§‹åŒ–æ–°çš„åœ°åœ–å¯¦ä¾‹
Â  Â  Â  Â  mapInstance = L.map('map').setView([lat, lon], 10);
Â  Â  Â  Â  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
Â  Â  Â  Â  Â  maxZoom: 19,
Â  Â  Â  Â  }).addTo(mapInstance);

Â  Â  Â  Â  L.marker([lat, lon]).addTo(mapInstance)
Â  Â  Â  Â  Â  .bindPopup(`${info.city || 'æœªçŸ¥åœ°é»'}, ${info.country || ''}`)
Â  Â  Â  Â  Â  .openPopup();

Â  Â  Â  } catch (error) {
Â  Â  Â  Â  ipEl.textContent = 'è¼‰å…¥å¤±æ•—';
Â  Â  Â  Â  detailsEl.innerHTML = '<div class="detail-box" style="width:100%; justify-content:center;">ç„¡æ³•è¼‰å…¥ IP è©³ç´°è³‡è¨Šï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</div>';
Â  Â  Â  Â  console.error('Error fetching IP or info:', error);
Â  Â  Â  }
Â  Â  }

Â  Â  document.getElementById("reload").onclick = fetchIP;
Â  Â  fetchIP();
Â  </script>

</body>
</html>