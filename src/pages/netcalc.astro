---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';

const title = 'ç¶²æ®µè¨ˆç®—æ©Ÿ';
const description = 'ç¶²æ®µè¨ˆç®—æ©Ÿï¼Œæä¾›å¿«é€ŸæŸ¥è©¢å¯ç”¨IPä½å€ã€å­ç¶²é®ç½©èˆ‡å»£æ’­åœ°å€ã€‚';
---

<!doctype html>
<html lang="zh-Hant">
<head>
    <!-- ğŸ’¡ BaseHead è² è²¬å¼•å…¥å…¨åŸŸ CSS -->
    <BaseHead title={title} description={description} />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      crossorigin="anonymous"
    />

    <!-- Google Ads -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6026639928482840"
      crossorigin="anonymous"
    ></script>

    <!-- å°ˆå±¬ CSS -->
<style>
    /* ===== æ•´é«”èƒŒæ™¯ ===== */
  body {
    background: #f5f7fb;
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
      "Helvetica Neue", Arial, "Noto Sans", sans-serif;
  }

  /* ===== ä¸»å¡ç‰‡ ===== */
  .calculator-container {
    background: #ffffff;
    padding: 2rem;
    border-radius: 18px;
    border: 1px solid #e5e7eb;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
    max-width: 880px;
    margin: 1.5rem auto;
    transition: 0.3s;
  }

  .calculator-container:hover {
    box-shadow: 0 10px 28px rgba(0, 0, 0, 0.06);
  }

  /* ===== æ¨™é¡Œ ===== */
  h1 {
    font-size: 1.9rem;
    color: #1f2937;
    margin-bottom: 1.8rem;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  h1 i {
    color: #555;
  }

  /* ===== è¼¸å…¥å€å¡Š ===== */
  .input-group {
    display: grid;
    grid-template-columns: 1fr;
    gap: 14px;
    margin-bottom: 20px;
  }

  @media (min-width: 760px) {
    .input-group {
      grid-template-columns: 1fr 1fr;
    }
  }

  input[type="text"] {
    padding: 14px 16px;
    border: 1px solid #d1d5db;
    border-radius: 10px;
    background: #f9fafb;
    font-size: 1rem;
    transition: 0.25s;
    box-sizing: border-box;
    width: 100%;
  }

  input[type="text"]:focus {
    border-color: #2563eb;
    background: #fff;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
  }

  /* ===== æŒ‰éˆ• ===== */
  .calculate-btn {
    padding: 14px 20px;
    border-radius: 10px;
    border: none;
    background: #2563eb;
    color: #fff;
    width: 100%;
    font-size: 1.05rem;
    font-weight: 600;
    cursor: pointer;
    margin-top: 4px;
    transition: 0.25s;
  }

  .calculate-btn:hover {
    background: #2563eb;
  }

  /* ===== äºŒé€²ä½åˆ‡æ› ===== */
  .toggle-bin {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: #f3f4f6;
    border-radius: 10px;
    color: #4b5563;
    cursor: pointer;
    margin-top: 16px;
    font-size: 0.95rem;
    transition: 0.25s;
  }

  .toggle-bin:hover {
    background: #e5e7eb;
    color: #1f2937;
  }

  /* ===== çµæœå€ ===== */
  .results {
    margin-top: 22px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .results > div {
    background: #ffffff;
    padding: 14px 16px;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 6px;
  }

  .results strong {
    color: #374151;
    width: 190px;
    font-weight: 600;
  }

  .results span {
    font-family: "Roboto Mono", monospace;
    font-size: 0.95rem;
    word-break: break-word;
  }

  /* ===== é‡é»çµæœï¼ˆè·Ÿ myip åŒèª¿æ€§ï¼‰ ===== */
  .primary-result {
    background: #eff6ff !important;
    border-left: 4px solid #2563eb !important;
    border-radius: 12px;
  }

  /* ===== äºŒé€²ä½å°å­— ===== */
  .binary-val {
    font-size: 0.82rem;
    color: #6b7280;
  }

  /* ===== éŒ¯èª¤è¨Šæ¯ ===== */
  .error-message {
    background: #fee2e2;
    border: 1px solid #fecaca;
    color: #b91c1c;
    padding: 14px;
    border-radius: 12px;
    font-weight: 700;
    text-align: center;
  }

  /* ===== æ‰‹æ©ŸéŸ¿æ‡‰å¼ä¿®æ­£ï¼ˆä¸è·‘ç‰ˆï¼‰ ===== */
  @media (max-width: 480px) {
    .results strong {
      width: 100%;
    }

    .calculator-container {
      padding: 1.3rem;
      margin: 1rem;
    }
  }
</style>
</head>

<body>
    <Header />

    <main>
      <div class="calculator-container">
        
        <h1><i class="fas fa-network-wired"></i> ç¶²æ®µè¨ˆç®—æ©Ÿ</h1>

        <!-- è¼¸å…¥æ¬„ä½ -->
        <div class="input-group">
          <input type="text" id="cidrInput" placeholder="IP/å­ç¶² (ä¾‹: 192.168.1.10/24)">
          <input type="text" id="maskInput" placeholder="æˆ–å­ç¶²é®ç½© (ä¾‹: 255.255.255.0)">
        </div>

        <button class="calculate-btn" onclick="calculate()">
          <i class="fas fa-calculator"></i> é–‹å§‹è¨ˆç®—
        </button>

        <div class="toggle-bin" id="toggleBinaryButton" onclick="toggleBinary()">
          <i class="fas fa-exchange-alt"></i> åˆ‡æ›äºŒé€²ä½é¡¯ç¤º
        </div>

        <!-- çµæœå€ -->
        <div class="results" id="results">
          <div style="text-align:center; border-bottom:none; background:transparent;">
            <i class="fas fa-mouse-pointer"></i> è«‹è¼¸å…¥ IP åœ°å€é–‹å§‹è¨ˆç®—
          </div>
        </div>
      </div>
    </main>

    <Footer />

    <!-- JS -->
    <script is:inline>
      /* IP Helper å‡½æ•¸ */
      function ipToInt(ipArr){
        return (ipArr[0]>>>0)*16777216 +
               (ipArr[1]>>>0)*65536 +
               (ipArr[2]>>>0)*256 +
               (ipArr[3]>>>0);
      }

      function intToIp(int){
        return [
          (int>>>24)&255,
          (int>>>16)&255,
          (int>>>8)&255,
          int&255
        ];
      }

      function ipToBinary(ip){
        return ip.split('.')
          .map(n => parseInt(n).toString(2).padStart(8, "0"))
          .join('.');
      }

      function isPrivateIP(ip){
        const [a,b] = ip.split('.').map(Number);
        if(a===10) return "ç§æœ‰ç¶²æ®µ (A é¡)";
        if(a===172 && b>=16 && b<=31) return "ç§æœ‰ç¶²æ®µ (B é¡)";
        if(a===192 && b===168) return "ç§æœ‰ç¶²æ®µ (C é¡)";
        if(a===127) return "è¿´åœˆæœ¬åœ° (Loopback)";
        if(a>=224 && a<=239) return "å¤šæ’­åœ°å€ (Multicast)";
        return "å…¬ç¶²IP";
      }

      let showBinary = false;

      function calculate(){
        const cidrInput = document.getElementById('cidrInput').value.trim();
        const maskVal   = document.getElementById('maskInput').value.trim();
        const results   = document.getElementById('results');

        let ip, mask, prefix;

        if(cidrInput.includes('/')){
          [ip, prefix] = cidrInput.split('/');
          prefix = parseInt(prefix);
          mask = Array(4).fill(0).map((_,i)=>{
            let rem = prefix - i*8;
            if(rem>=8) return 255;
            if(rem<=0) return 0;
            return 256 - Math.pow(2, 8-rem);
          }).join('.');
        }
        else if(cidrInput && maskVal){
          ip = cidrInput;
          mask = maskVal;
          prefix = mask.split('.')
                         .map(n => parseInt(n).toString(2).replace(/0/g,"").length)
                         .reduce((a,b)=>a+b,0);
        }
        else {
          results.innerHTML =
            `<div class="error-message"><i class="fas fa-exclamation-triangle"></i> è«‹è¼¸å…¥æœ‰æ•ˆ IP æˆ– CIDR</div>`;
          return;
        }

        const ipParts  = ip.split('.').map(Number);
        const maskParts = mask.split('.').map(Number);

        if(ipParts.some(n=>isNaN(n)||n<0||n>255)
        || maskParts.some(n=>isNaN(n)||n<0||n>255)
        || prefix<0 || prefix>32){
          results.innerHTML =
            `<div class="error-message"><i class="fas fa-exclamation-triangle"></i> è¼¸å…¥æ ¼å¼éŒ¯èª¤ (IP 0â€“255, CIDR 0â€“32)</div>`;
          return;
        }

        const network  = ipParts.map((n,i)=> n & maskParts[i]);
        const wildcard = maskParts.map(n => (~n & 255));
        const broadcast = network.map((n,i)=> n | wildcard[i]);

        const netInt = ipToInt(network);
        const bcInt  = ipToInt(broadcast);

        let hostMinInt, hostMaxInt, hostCount = Math.pow(2, 32-prefix);

        if(prefix === 32){
          hostMinInt = hostMaxInt = netInt;
          hostCount = 1;
        } else if(prefix === 31){
          hostMinInt = netInt;
          hostMaxInt = bcInt;
          hostCount = 2;
        } else {
          hostMinInt = netInt + 1;
          hostMaxInt = bcInt - 1;
          hostCount -= 2;
        }

        const hostMin = intToIp(hostMinInt);
        const hostMax = intToIp(hostMaxInt);

        function display(arr){
          const str = arr.join('.');
          return showBinary
            ? `<span class="binary-val">${ipToBinary(str)}</span><span>(${str})</span>`
            : str;
        }

        function displayMask(m){
          return showBinary
            ? `<span class="binary-val">${ipToBinary(m)}</span><span>(${m})</span>`
            : m;
        }

        results.innerHTML = `
          <div><strong><i class="fas fa-search"></i> è¼¸å…¥ IP:</strong><span>${display(ipParts)}</span></div>
          <div><strong><i class="fas fa-tag"></i> IP é¡å‹:</strong><span>${isPrivateIP(ip)}</span></div>
          <div><strong><i class="fas fa-divide"></i> å­ç¶²ä½å…ƒ (CIDR):</strong><span>/${prefix}</span></div>
          <div><strong><i class="fas fa-bars"></i> å­ç¶²é®ç½© (Mask):</strong><span>${displayMask(mask)}</span></div>
          
          <div class="primary-result">
            <strong><i class="fas fa-home"></i> ç¶²æ®µä½å€ (Network ID):</strong>
            <span>${display(network)}</span>
          </div>

          <div class="primary-result">
            <strong><i class="fas fa-broadcast-tower"></i> å»£æ’­ä½å€ (Broadcast):</strong>
            <span>${display(broadcast)}</span>
          </div>

          <div class="primary-result">
            <strong><i class="fas fa-arrows-alt-h"></i> å¯ç”¨ä¸»æ©Ÿç¯„åœ:</strong>
            <span>${display(hostMin)} - ${display(hostMax)}</span>
          </div>
          
          <div><strong><i class="fas fa-users"></i> å¯ç”¨ä¸»æ©Ÿæ•¸é‡:</strong><span>${hostCount}</span></div>
        `;
      }

      function toggleBinary(){
        showBinary = !showBinary;

        document.getElementById('toggleBinaryButton').innerHTML =
          showBinary
          ? `<i class="fas fa-align-left"></i> åˆ‡æ›ç‚ºåé€²ä½é¡¯ç¤º`
          : `<i class="fas fa-exchange-alt"></i> åˆ‡æ›äºŒé€²ä½é¡¯ç¤º`;

        if (document.getElementById('cidrInput').value.trim() || document.getElementById('maskInput').value.trim()) {
          calculate();
        }
      }
    </script>
</body>
</html>
